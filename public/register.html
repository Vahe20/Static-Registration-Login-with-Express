<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Registration</title>
		<link rel="stylesheet" href="css/register.css" />
	</head>
	<body>
		<div class="container">
			<h1>Registration</h1>
			<form
				id="registrationForm"
				method="POST"
				action="/api/register"
				enctype="multipart/form-data"
			>
				<!-- Required Fields -->
				<div class="form-group">
					<label for="fullName" class="required">Full Name</label>
					<input type="text" id="fullName" name="fullName" required />
					<div class="error" id="fullNameError">
						Full name is required
					</div>
				</div>

				<div class="form-group">
					<label for="email" class="required">Email</label>
					<input type="email" id="email" name="email" required />
					<div class="error" id="emailError">
						Valid email is required
					</div>
				</div>

				<div class="form-group">
					<label for="password" class="required">Password</label>
					<input
						type="password"
						id="password"
						name="password"
						required
					/>
					<div class="error" id="passwordError">
						Password must be at least 6 characters
					</div>
				</div>

				<div class="form-group">
					<label for="profileImage"
						>Profile Image
						<span class="optional-text">(Optional)</span></label
					>
					<input type="file" id="profileImage" name="profileImage" />
				</div>

				<div class="form-group">
					<label for="college"
						>College / University
						<span class="optional-text">(Optional)</span></label
					>
					<input type="text" id="college" name="college" />
				</div>

				<div class="form-group">
					<label for="hobby"
						>Hobby
						<span class="optional-text">(Optional)</span></label
					>
					<input type="text" id="hobby" name="hobby" />
				</div>

				<div class="form-row">
					<div class="form-group">
						<label for="phone"
							>Phone Number
							<span class="optional-text">(Optional)</span></label
						>
						<input
							type="tel"
							id="phone"
							name="phone"
							pattern="[0-9\+\-\s\(\)]{10,}"
						/>
						<div class="error" id="phoneError">
							Valid phone number is required
						</div>
					</div>

					<div class="form-group">
						<label for="age"
							>Age
							<span class="optional-text">(Optional)</span></label
						>
						<input
							type="number"
							id="age"
							name="age"
							min="13"
							max="120"
						/>
						<div class="error" id="ageError">
							Age must be between 13 and 120
						</div>
					</div>
				</div>

				<div class="form-group">
					<label for="city"
						>City
						<span class="optional-text">(Optional)</span></label
					>
					<input type="text" id="city" name="city" />
				</div>

				<div class="form-group">
					<label for="github"
						>GitHub Link
						<span class="optional-text">(Optional)</span></label
					>
					<input
						type="text"
						id="github"
						name="github"
						placeholder="https://github.com/username"
					/>
					<div class="error" id="githubError">
						Valid GitHub URL is required
					</div>
				</div>

				<div class="form-group">
					<label for="bio"
						>Short Bio
						<span class="optional-text">(Optional)</span></label
					>
					<textarea
						id="bio"
						name="bio"
						placeholder="Tell us about yourself..."
					></textarea>
				</div>

				<button type="submit">Register</button>
			</form>

			<p>Already have an account? <a href="login.html">Login here</a></p>
		</div>

		<script>
			const form = document.getElementById("registrationForm");

			form.addEventListener("submit", function (e) {
				e.preventDefault();
				if (validateForm()) {
					const file =
						document.getElementById("profileImage").files[0];
					fetch("/api/register", {
						method: "POST",
						headers: {
							"Content-Type": "application/json",
						},
						body: JSON.stringify({
							fullName: document
								.getElementById("fullName")
								.value.trim(),
							email: document
								.getElementById("email")
								.value.trim(),
							password: document.getElementById("password").value,
							college: document
								.getElementById("college")
								.value.trim(),
							hobby: document
								.getElementById("hobby")
								.value.trim(),
							phone: document
								.getElementById("phone")
								.value.trim(),
							age: document.getElementById("age").value,
							city: document.getElementById("city").value.trim(),
							github: document
								.getElementById("github")
								.value.trim(),
							bio: document.getElementById("bio").value.trim(),
						}),
					})
						.then(response => response.json())
						.then(data => {
							if (data.ok) {
								alert("Registration successful!");
								window.location.href = "login.html";
							} else {
								alert("Error: " + data.message);
								return;
							}
						})
						.catch(error => {
							console.error("Error:", error);
							alert("An error occurred during registration.");
							return;
						});

					if (file) {
						const formData = new FormData();
						formData.append("profileImage", file);
						formData.append(
							"email",
							document.getElementById("email").value.trim()
						);

						fetch("/api/uploadProfileImage", {
							method: "POST",
							body: formData,
						})
							.then(response => response.json())
							.then(data => {
								if (data.ok) {
									console.log(
										"Profile image uploaded successfully"
									);
								} else {
									console.error(
										"Error uploading profile image:",
										data.message
									);
								}
							})
							.catch(error => {
								console.error(
									"Error uploading profile image:",
									error
								);
							});
					}
				}
			});

			function validateForm() {
				let isValid = true;

				const fullName = document
					.getElementById("fullName")
					.value.trim();
				if (!fullName) {
					showError("fullNameError");
					isValid = false;
				} else {
					hideError("fullNameError");
				}

				const email = document.getElementById("email").value.trim();
				const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
				if (!emailRegex.test(email)) {
					showError("emailError");
					isValid = false;
				} else {
					hideError("emailError");
				}

				const password = document.getElementById("password").value;
				if (password.length < 6) {
					showError("passwordError");
					isValid = false;
				} else {
					hideError("passwordError");
				}

				const phone = document.getElementById("phone").value.trim();
				if (phone && !/^[0-9\+\-\s\(\)]{10,}$/.test(phone)) {
					showError("phoneError");
					isValid = false;
				} else {
					hideError("phoneError");
				}

				const age = document.getElementById("age").value;
				if (age && (age < 13 || age > 120)) {
					showError("ageError");
					isValid = false;
				} else {
					hideError("ageError");
				}

				const github = document.getElementById("github").value.trim();
				if (github && !github.includes("github.com")) {
					showError("githubError");
					isValid = false;
				} else {
					hideError("githubError");
				}

				return isValid;
			}

			function showError(elementId) {
				document.getElementById(elementId).style.display = "block";
			}

			function hideError(elementId) {
				document.getElementById(elementId).style.display = "none";
			}
		</script>
	</body>
</html>
